function serialize(e,t){var n,s=[];for(n in e)if(e.hasOwnProperty(n)){var o=t?t+"["+n+"]":n,i=e[n];s.push(null!==i&&"object"==typeof i?serialize(i,o):encodeURIComponent(o)+"="+encodeURIComponent(i))}return s.join("&")}function constructDentistSearchParams(){var e={},t=Object.keys(SEARCH_FORM.ids);for(var n in t){var s;if("opening_days"==SEARCH_FORM.ids[t[n]])s=[],$("input[name=opening_days]").each(function(e,t){$(this).prop("checked")&&s.push($(this).val())});else if("opening_hours_start"==SEARCH_FORM.ids[t[n]]||"opening_hours_end"==SEARCH_FORM.ids[t[n]]){var o="opening_hours_start"==SEARCH_FORM.ids[t[n]]?"from":"to",i=0;s="",$("input[name="+o+"]").each(function(e,t){$(this).attr("id")===o+"_hour"&&($(this).val()?s=1===$(this).val().length?"0"+$(this).val():$(this).val():(s="00",i++)),$(this).attr("id")===o+"_minute"&&($(this).val()?s+=1===$(this).val().length?"0"+$(this).val():$(this).val():(i++,"00"==s&&"to"===o?s="2359":s+="00"))}),2===i&&(s=!1)}else{var a=$("#"+SEARCH_FORM.ids[t[n]]);s=a.val(),"has_photo"==a.attr("id")&&(s=a.prop("checked")?"true":"false")}s&&(e[SEARCH_FORM.ids[t[n]]]=s)}return e}function constructLoginParams(){var e={username:$("#"+LOGIN_FORM.ids.USERNAME).val(),password:$("#"+LOGIN_FORM.ids.PASSWORD).val()};return e}function constructSignUpParams(){var e={username:$("#signUpUsername").val(),firstname:$("#signUpfirstName").val(),password:$("#signUpPassword").val()};return e}function checkLoginStatus(){return localStorage.getItem("user")?!0:!1}function constructDentistElem(e){var t=$("<div>",{id:"dentist-"+e.id,"data-id":e.id}),n='<p class="dentist-info working-hours">';if(e.openings){var s=JSON.parse(e.openings)[0];for(var o in s)n+=o.charAt(0).toUpperCase()+o.slice(1)+": "+s[o].open+"-"+s[o].close+", ","wed"===o&&(n+="</br>")}return n+="</p>",t.html('<div class="result-card '+("1"===e.cont_by_user?'contacted"':'"')+'><p><div class="dentist-details"><h1 class="dentist-name"><b>'+e.first_name+" "+e.last_name+"</b></h1> "+(e.specialty_id?'<p class="dentist-info specialty">'+SPECIALITIES[e.specialty_id]+"</p>":"")+(e.address?'<p class="dentist-info address" onclick="openMap(\''+e.address+", "+e.city+"');\">"+e.address+", "+e.city+"</p>":"")+(e.email?'<p class="dentist-info email" onclick="openEmail(\''+e.email+"');\">"+e.email+"</p>":"")+(e.phone?'<p class="dentist-info phone" onclick="openPhone(\''+e.phone+"');\">"+e.phone+"</p>":"")+(e.openings?n:"")+'</div><div class="dentist-image">'+(e.image?'<img class="user-image" src="'+e.image+'">':'<p class="image-placeholder">(No image)</p>')+'</div><div class="contact-button-div">'+("1"===e.cont_by_user?'<h6 class="visited-before">Added to Contacted</h6>':"")+("0"===e.cont_by_user?'<button class="contact-button" type="button" onclick="contactDentist('+e.id+');">Add to Contacted</button>':"")+("1"===e.cont_by_user?'<button class="contact-button" type="button" onclick="removeContactDentist('+e.id+');">Remove</button>':"")+"</div></p></div>"),t}function enterEmptyElement(){var e=$(DENTISTS_LIST);e.html('<p class="empty_element">No dentists found. Try again with another Search!</p>')}function populateDentists(e,t){for(var n in e)t.append(constructDentistElem(e[n]));0===e.length&&enterEmptyElement();var s=$("<p>",{id:"counter"});s.html(e.length+" dentists found!"),$("#search_form").append(s)}function login(){var t=HOST+RESOURCES.login,n=constructLoginParams();$("p#login-error").remove();var s=new XMLHttpRequest;s.open("POST",t,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onload=function(t){if(s.status>=200&&s.status<400){var t=JSON.parse(s.responseText);localStorage.setItem("user",JSON.stringify(t)),checkLoggedInStatus(),hidepopup()}else{var n=$("<p>",{id:"login-error"}),o=JSON.parse(e.responseText);console.error(o),n.html(o.msg),$("form.login-form").prepend(n)}},s.send(JSON.stringify(n))}function signUp(){var t=HOST+RESOURCES.signUp,n=constructSignUpParams();$("p#signUp-error").remove();var s=new XMLHttpRequest;s.open("POST",t,!0),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.onload=function(t){if(s.status>=200&&s.status<400)localStorage.setItem("user",JSON.stringify(n)),checkLoggedInStatus(),hidepopup();else{console.error("SignUp impossible");var o=$("<p>",{id:"signUp-error"}),i=JSON.parse(e.responseText);console.error(i),loginError.html(i.msg),$("form.signup-form-title").prepend(o)}},s.send(JSON.stringify(n))}function logout(){var e=HOST+RESOURCES.logout,t=new XMLHttpRequest;t.open("GET",e,!0),t.onload=function(){if(t.status>=200&&t.status<400){localStorage.removeItem("user"),localStorage.removeItem("dentists"),checkLoggedInStatus();JSON.parse(t.responseText)}else console.error("Logout error!"),localStorage.removeItem("user"),localStorage.removeItem("dentists"),checkLoggedInStatus()},t.onerror=function(){console.error("Logout error!"),localStorage.removeItem("user"),localStorage.removeItem("dentists"),checkLoggedInStatus()},t.send()}function getDentists(){var e=DENTISTS_LIST,t=$(e),n=HOST+RESOURCES.dentists,s=constructDentistSearchParams();showLoader(),$("p#counter").remove();var o=new XMLHttpRequest;o.open("GET",n+"?"+serialize(s),!0),o.onload=function(){if(o.status>=200&&o.status<400){var e=JSON.parse(o.responseText);t.empty(),populateDentists(e,t),localStorage.setItem("dentists",JSON.stringify(e))}else console.error(o),enterEmptyElement()},o.onerror=function(){console.error(o),enterEmptyElement()},o.send()}function getContactedDentists(){var t=DENTISTS_LIST,n=$(t),s=HOST+RESOURCES.contactedDentists;$("p#counter").remove(),showLoader();var o=new XMLHttpRequest;o.open("GET",s,!0),o.onload=function(){if(o.status>=200&&o.status<400){var e=JSON.parse(o.responseText);$(t).empty(),populateDentists(e,n)}else showpopup()},o.onerror=function(){console.error(e),enterEmptyElement()},o.send()}function contactDentist(e){var t=HOST+RESOURCES.contactDentist,n=getLoggedUser();if(!n)return void showpopup();var s={id:e,user:n.id},o=new XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.onload=function(t){if(o.status>=200&&o.status<400){var n=(JSON.parse(o.responseText),$("div#dentist-"+e)),s=$("<h6>",{"class":"visited-before"});s.html("Added to Contacted"),n.find(".result-card").addClass("contacted"),n.find(".contact-button-div").prepend(s),n.find("button").remove(),n.find(".result-card").append('<button class="contact-button" type="button" onclick="removeContactDentist('+e+');">Remove</button>')}else console.error(o),showpopup()},o.send(JSON.stringify(s))}function removeContactDentist(e){var t=HOST+RESOURCES.removeContactedDentist,n=getLoggedUser();if(!n)return void showpopup();var s={id:e,user:n.id},o=new XMLHttpRequest;o.open("POST",t,!0),o.setRequestHeader("Content-Type","application/json; charset=UTF-8"),o.onload=function(t){if(o.status>=200&&o.status<400){var n=(JSON.parse(o.responseText),$("div#dentist-"+e));2===ACTIVE_TAB?(n.remove(),0===$('*[id^="dentist-"]').length&&enterEmptyElement()):(n.find(".result-card").removeClass("contacted"),n.find(".visited-before").remove(),n.find("button").remove(),n.find(".result-card").append('<button class="contact-button" type="button" onclick="contactDentist('+e+');">Add to Contacted</button>'))}else console.error(o),showpopup()},o.send(JSON.stringify(s))}function startSearch(){2===ACTIVE_TAB&&($("li.menu_tab").each(function(e,t){$(this).removeClass("active")}),$("li#search-form-link").addClass("active"),ACTIVE_TAB=1),getDentists()}function changeTab(e){if(1===ACTIVE_TAB&&1!==e)$("li.menu_tab").each(function(e,t){$(this).removeClass("active")}),ACTIVE_TAB=2,getContactedDentists(),$("li#contacted-dentists-link").addClass("active");else if(2===ACTIVE_TAB&&2!==e){$("li.menu_tab").each(function(e,t){$(this).removeClass("active")}),ACTIVE_TAB=1,$("li#search-form-link").addClass("active");var t=localStorage.getItem("dentists");if(t){var n=DENTISTS_LIST,s=$(n);$("p#counter").remove(),s.empty(),populateDentists(JSON.parse(t),s)}else enterEmptyElement()}}function getLoggedUser(){return JSON.parse(localStorage.getItem("user"))}function openMap(e){window.open("https://maps.google.com/?q="+e+"&sensor=true","_blank")}function openEmail(e){window.open("mailto:"+e+"?Subject=Appointment","_top")}function openPhone(e){window.open("tel:"+e,"_top")}function showLoader(){var e=DENTISTS_LIST,t=$(e);$("p#counter").remove(),t.empty(),t.append('<div class="loader"></div>')}function showpopup(){$("#login-modal").fadeIn(),$("#login-modal").css({visibility:"visible",display:"block"})}function hidepopup(){$("#login-modal").fadeOut(),$("#login-modal").css({visibility:"hidden",display:"none"}),changeTab(1)}function showSignUpModal(){$("#login-form").fadeOut(),$("#login-form").css({visibility:"hidden",display:"none"}),$("#signup-form").fadeIn(),$("#signup-form").css({visibility:"visible",display:"block"})}function hideSignUpModal(){$("#signup-form").fadeOut(),$("#signup-form").css({visibility:"hidden",display:"none"}),$("#login-form").fadeIn(),$("#login-form").css({visibility:"visible",display:"block"})}function checkLoggedInStatus(){if(checkLoginStatus()){$("#menu #name").css({visibility:"visible",display:"block"});var e=getLoggedUser();$("#menu #name").html(e.firstname),$("#menu #logout").css({visibility:"visible",display:"block"}),$("#menu #login").css({visibility:"hidden",display:"none"})}else $("#menu #name").css({visibility:"hidden",display:"none"}),$("#menu #logout").css({visibility:"hidden",display:"none"}),$("#menu #login").css({visibility:"visible",display:"block"})}var HOST="",RESOURCES={login:"api/login.php",logout:"api/logout.php",signUp:"api/signup.php",dentists:"api/dentists.php",contactedDentists:"api/dentists/contacted.php",contactDentist:"api/dentists/contact.php",removeContactedDentist:"api/dentists/removeContact.php"},LOGIN_FORM={ids:{USERNAME:"username",PASSWORD:"password"}},SIGNUP_FORM={ids:{USERNAME:"username",EMAIL:"email",FIRST_NAME:"firstname"}},SEARCH_FORM={ids:{FIRST_NAME:"first_name",LAST_NAME:"last_name",GENDER:"gender",ADDRESS:"address",CITY:"city",OPENING_DAYS:"opening_days",OPENING_HOUR_START:"opening_hours_start",OPENING_HOUR_END:"opening_hours_end",SPECIALITY:"specialty",HAS_PHOTO:"has_photo"}},DENTISTS_LIST="#dentists",SPECIALITIES={101:"Dental Public Health",102:"Endodontics",103:"Prosthodontics",104:"Oral and Maxillofacial Pathology",105:"Oral and Maxillofacial Radiology",106:"Oral and Maxillofacial Surgery",107:"Orthodontics and Dentofacial Orthopedics",108:"Pediatric Dentistry",109:"Periodontics"},ACTIVE_TAB=1;$(document).ready(function(){checkLoggedInStatus(),enterEmptyElement(),$("#login").click(function(){showpopup()}),$(".close-login-form").click(function(){hidepopup()})});